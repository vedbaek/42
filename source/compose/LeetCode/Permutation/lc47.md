# 47. å…¨æ’åˆ— IIâ­â­

![](../../../_static/leetcode/lc47_01.png)

## åˆ†æ
* æœ‰é‡å¤åºåˆ—çš„å…¨æ’åˆ—ä¹Ÿæ˜¯å…¨æ’åˆ—ï¼Œå…ˆè§£å†³å…¨æ’åˆ—é—®é¢˜è¿™ä¸ªé—®é¢˜å°±è§£äº†ä¸€åŠ
* åºåˆ—ä¸­åŒ…å«é‡å¤æ•°å­—ï¼Œä¼šå¯¼è‡´ç»“æœä¸­äº§ç”Ÿå¾ˆå¤šé‡å¤ç»„åˆ
* æ¶ˆé™¤é‡å¤æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æš´åŠ›ä»å…¨æ’åˆ—ç»“æœä¸­éå†å»é‡ï¼ˆå°±ä¸æ¨èäº†ï¼Œä½†æ˜¯èƒ½è§£å†³é—®é¢˜ï¼‰
* ä¸€ç§æ˜¯æ±‚è§£è¿‡ç¨‹ä¸­å°±è·³è¿‡é‡å¤é¡¹çš„é­”æ³•

## é‡å¤ç»„åˆé—®é¢˜
```{admonition} æ¶ˆé™¤é‡å¤ç»„åˆçš„é­”æ³•
ç›´æ¥ä¸Šç»“è®ºï¼š
* å°†åŸå§‹æ•°åˆ—æ’åºï¼Œä»¥ä¿è¯ç›¸åŒçš„æ•°å­—éƒ½åœ¨ä¸€èµ·
* åœ¨æœ¬è½®éå†è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¿™ä¸ªæ•°å­—æŒ‰ç´¢å¼•æ­£åºè¿ç»­å‡ºç°è¿‡2æ¬¡ï¼ˆä¸æ˜¯3æ¬¡æˆ–æ›´å¤šï¼‰ï¼Œå°±è·³è¿‡
```

```cpp
if (visited[i] ||
    (i > 0 && visited[i - 1] && nums[i] == nums[i - 1])) {
    continue;
}
```

* è¿™ä¸ªç»“è®ºæˆ‘æƒ³äº†å¾ˆä¹…éƒ½æ²¡ç›¸é€šï¼Œè„‘å­è¿™ä¸ªå¥½ä¸œè¥¿æˆ‘å®åœ¨æ˜¯ä¸å¤Ÿç”¨ï¼Œç”»ä¸ªå›¾æ¥è¾…åŠ©ç†è§£ï¼š
1. è¿™ä¸ªé­”æ³•ç”Ÿæ•ˆçš„å‰ææ˜¯è¦æœ‰åºï¼Œæ‰€ä»¥éœ€è¦å¯¹numsæ•°åˆ—è¿›è¡Œæ’åº
2. æ ¹æ®å›¾ç¤ºï¼Œç›¸åŒæ•°å­—è¿ç»­å‡ºç°ä¸¤æ¬¡æ—¶ä¼šè¢«æ’é™¤æ‰ï¼ŒæŒ‰ç´¢å¼•æ­£åºå‡ºç°ï¼ˆçº¢é»„æ ‡è®°ï¼‰
3. ç›¸åŒæ•°å­—æŒ‰ç´¢å¼•é€†åºåŒæ—¶å‡ºç°åˆ™è¢«ä¿ç•™
4. ä»»æ„ä¸¤ä¸ªç›¸åŒæ•°å­—ä¹‹é—´çš„ç›¸å¯¹ä½ç½®å…³ç³»åªæœ‰ä¸¤ç§ï¼Œè¦ä¹ˆæ˜¯ç´¢å¼•æ­£åºï¼Œè¦ä¹ˆæ˜¯ç´¢å¼•é€†åºï¼Œè¿™é‡Œåˆšå¥½æ’é™¤äº†ä¸€åŠ
![](../../../_static/leetcode/lc47_02.png)


* æ¢ä¸€ç§å†™æ³•ä¹Ÿå¯ä»¥ï¼Œè¿™æ¬¡åˆšå¥½è¿‡æ»¤æ‰ç›¸åŒæ•°å­—é€†åºç»„åˆï¼ˆæ²¡åŠæ³•æ‰¿è®¤æˆ‘çœ‹æ¼äº†å®˜æ–¹é¢˜è§£çš„æ„Ÿå¹å·ğŸ˜“ï¼‰
```
if (visited[i] ||
    (i > 0 && !visited[i - 1] && nums[i] == nums[i - 1])) {
    continue;
}
```

* è¿™é­”æ³•å¤ªç¥å¥‡ï¼Œæˆ‘åˆéªŒè¯äº†ä¸€ä¸‹æ•°åˆ—$[3,3,0,3]$
![](../../../_static/leetcode/lc47_03.png)

## é¢˜è§£ï¼šåŸºäº$Visited$é­”æ³•
* `searchPath`è¡¨ç¤ºå½“å‰æœç´¢è·¯å¾„ï¼Œ`visited`è¡¨ç¤ºå½“å‰èŠ‚ç‚¹æ˜¯å¦å·²æ·»åŠ åˆ°è·¯å¾„
* å…ˆæŒ‰ç…§æ— é‡å¤å…¨æ’åˆ—æ€è·¯åšä¸€é
* ç„¶ååŠ ä¸Šè¿‡æ»¤æ¡ä»¶å³å¯
```cpp
vector<vector<int>> permute(vector<int>& nums) {
    // ä¿å­˜ç»“æœ
    vector<vector<int>> result;
    // ä¿å­˜è®¿é—®çŠ¶æ€
    vector<bool> visited(nums.size(), false);
    // ä¿å­˜è®¿é—®è·¯å¾„
    vector<int> searchPath;
    // æ·±åº¦ä¼˜å…ˆæœç´¢æ‰€æœ‰ç»„åˆ
    deepSearch(result, nums, searchPath, visited);
    return result;
}

// æ·±åº¦ä¼˜å…ˆæœç´¢
void deepSearch(vector<vector<int>>& result, vector<int>& nums,
                vector<int>& searchPath, vector<bool>& visited) {
    // è®¿é—®è·¯å¾„é•¿åº¦å’Œæ•°ç»„numsä¸€è‡´è¡¨ç¤ºå·²ç»è®¿é—®åˆ°å¶å­èŠ‚ç‚¹ï¼Œå¯ä»¥å›æº¯äº†
    if (nums.size() == searchPath.size()) {
        // ä¿å­˜æœ¬æ¬¡æœç´¢è·¯å¾„
        result.emplace_back(searchPath);
        return;
    }

    for (int i = 0; i < nums.size(); i++) {
        // è·³è¿‡å·²è®¿é—®è¿‡çš„ç´¢å¼•
        if (visited[i] ||
            // è·³è¿‡ç›¸åŒæ•°å­—ç´¢å¼•æ­£åºè¿ç»­å‡ºç°çš„ç»„åˆ
            (i > 0 && visited[i - 1] && nums[i] == nums[i - 1])) {
            continue;
        }

        // æ ‡è®°å·²è®¿é—®ç´¢å¼•
        visited[i] = true;
        // å°†å·²è®¿é—®çš„èŠ‚ç‚¹æ·»åŠ åˆ°å½“å‰æœç´¢è·¯å¾„
        searchPath.push_back(nums[i]);

        // é€’å½’æœç´¢ä¸‹ä¸€å±‚
        deepSearch(result, nums, searchPath, visited);

        // é€’å½’é€€å‡ºåæ¢å¤çŠ¶æ€
        visited[i] = false;
        searchPath.pop_back();
    }
}
```

## é¢˜è§£ï¼šåŸºäº$Swap$é­”æ³•
* å…ˆåŸºäº$Swap$é­”æ³•å‡è£…æ— é‡å¤å…ƒç´ åšä¸€éå…¨æ’åˆ—ï¼Œç„¶åæ·»åŠ å»é‡é€»è¾‘
* å»é‡çš„å…³é”®åœ¨äºç”¨ä¸€ä¸ªé¢å¤–çš„å“ˆå¸Œè¡¨æ¥é¿å…å½“å‰èŠ‚ç‚¹çš„é‡å…¥
![](../../../_static/leetcode/lc47_04.png)
```cpp
vector<vector<int>> permuteUnique(vector<int>& nums) {
    // ä¿å­˜æ‰€æœ‰ç»“æœé›†
    vector<vector<int>> result;
    // æ·±åº¦ä¼˜å…ˆæœç´¢æ‰€æœ‰ç»„åˆ
    deepSearch(result, nums, 0);
    return result;
}

void deepSearch(vector<vector<int>>& result, vector<int>& nums, int depth) {
    // æœç´¢å®Œæˆï¼Œå›æº¯ç»“æœ
    if (depth == nums.size()) {
        result.emplace_back(nums);
        return;
    }

    // å»é‡å…³é”®ï¼šé¿å…é‡å¤æœç´¢
    set<int> used;
    // æ³¨æ„ï¼šä»å½“å‰æ·±åº¦å¼€å§‹å¾€ä¸‹é€’å½’ï¼Œè€Œä¸æ˜¯ä»0å¼€å§‹
    for (int i = depth; i < nums.size(); i++) {
        // å»é‡
        if (used.count(nums[i])) {
            continue;
        }
        used.insert(nums[i]);
        // ç¡®è®¤depthä½çš„å…ƒç´ 
        swap(nums[depth], nums[i]);
        // é€’å½’è®¿é—®ä¸‹ä¸€ä¸ªå…ƒç´ 
        deepSearch(result, nums, depth+1);
        // é€’å½’å›æº¯åæ¢å¤çŠ¶æ€ï¼Œæ–¹ä¾¿ä¸‹ä¸€è½®å°†å…¶å®ƒå…ƒç´ å¡«åˆ°è¿™ä¸ªä½ç½®
        swap(nums[depth], nums[i]);
    }
}
```

## å‚è€ƒ
[1] 47. å…¨æ’åˆ— II https://leetcode.cn/problems/permutations-ii/

