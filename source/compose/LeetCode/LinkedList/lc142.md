
# 142. 环形链表 II


## 题解一：哈希表
用哈希表记录每个已遍历的节点，一旦遇到之前记录过节点，即找到环的入口
```cpp
ListNode* detectCycle(ListNode* head) {
    unordered_set<ListNode*> visit;
    while (head) {
        if (visit.count(head)) {
            return head;
        }
        visit.insert(head);
        head = head->next;
    }
    return nullptr;
}
```

## 题解二：快慢指针
![](../../../_static/leetcode/lc142_01.png)
* 假设表头到入口直线距离为$ straight_{[1..4]} $个节点（不包含入口），环长为$circle_{[5..9]}$，总长为$straight + circle $
* 慢指针$slow$每次走一步，快指针$fast$每次走两步
* 快慢指针相遇时（假设有环），快指针比慢指针多走两倍路程：$fast = 2 \times slow$
* 快慢指针相遇时，快指针比慢指针多走了$n$圈：$fast = slow + n_{[0..\infty]} \times circle$
* 根据前面的方程得出：$slow=n \times circle$

### 重点来了（也是难以理解的点）
* 任意指针从起始位置$①$走到入口需要步数：$straight + n_{[0..\infty]} \times circle$
* 慢指针$slow$已经走了$n \times circle$，继续往前走$straight$步一定可以达到入口处
* 第一次相遇后，将$fast$指针重置到起始位置$①$，并且将其速度也重置为$1$
* $slow$和$fast$指针继续向前走直到再次相遇，这次相遇走的步数刚好为$straight$，即走到了环的入口处$⑤$

### 总结
* 利用快慢指针追击，直至第一次在环中相遇，如果提前遇到空指针则表示无环
* 第一次相遇后重置快指针速度并放到起始位置，重新追击直至第二次相遇
* 第二次相遇点即为环的入口

```cpp
ListNode* detectCycle(ListNode* head) {
    ListNode *fast = head, *slow = head;
    while(fast && fast->next) {
        fast = fast->next->next;
        slow = slow->next;
        // 第一次相遇
        if (fast == slow) {
            fast = head;
            // 第二次相遇
            while (fast != slow) {
                fast = fast->next;
                slow = slow->next;
            }
            return fast;
        }
    }
    return nullptr;
}
```

## 参考
[1] 142. 环形链表 II https://leetcode.cn/problems/linked-list-cycle-ii/